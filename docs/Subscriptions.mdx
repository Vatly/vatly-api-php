export const metadata = {
  title: 'Subscriptions (PHP SDK)',
  description:
    'Learn how to manage subscriptions using the Vatly PHP SDK.',
}

# Subscriptions

Subscriptions are created automatically when a customer completes a checkout for a subscription plan. You can then manage the subscription lifecycle through the API. {{ className: 'lead' }}

## The Subscription Resource

Below you'll find all properties for the Vatly Subscription resource.

### Properties

<Properties>
  <Property name="id" type="string">
    Unique identifier for the subscription (`sub_...`).
  </Property>
  <Property name="status" type="string">
    The status: `active`, `canceled`, `past_due`, `trialing`, `paused`, or `ended`.
  </Property>
  <Property name="customerId" type="string">
    The customer ID.
  </Property>
  <Property name="planId" type="string">
    The subscription plan ID.
  </Property>
  <Property name="testmode" type="bool">
    Whether this is a test subscription.
  </Property>
  <Property name="currentPeriodStart" type="string">
    Current billing period start (ISO 8601).
  </Property>
  <Property name="currentPeriodEnd" type="string">
    Current billing period end (ISO 8601).
  </Property>
  <Property name="canceledAt" type="string|null">
    When the subscription was canceled (ISO 8601).
  </Property>
  <Property name="endedAt" type="string|null">
    When the subscription ended (ISO 8601).
  </Property>
  <Property name="trialStart" type="string|null">
    Trial period start (ISO 8601).
  </Property>
  <Property name="trialEnd" type="string|null">
    Trial period end (ISO 8601).
  </Property>
  <Property name="metadata" type="array">
    Your custom metadata.
  </Property>
  <Property name="createdAt" type="string">
    Creation timestamp (ISO 8601).
  </Property>
</Properties>

---

## Retrieve a subscription {{ tag: 'GET', label: '/v1/subscriptions/:id' }}

<Row>
  <Col>

    Retrieve a subscription by its ID.

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/subscriptions/:id">

    ```php {{ title: 'PHP' }}
    $subscription = $vatly->subscriptions->get('sub_abc123');

    echo $subscription->status;
    echo $subscription->planId;

    if ($subscription->isActive()) {
        echo 'Subscription is active';
    }
    ```

    </CodeGroup>

  </Col>
</Row>

---

## List all subscriptions {{ tag: 'GET', label: '/v1/subscriptions' }}

<Row>
  <Col>

    Retrieve a paginated list of all subscriptions.

    ### Optional attributes

    <Properties>
      <Property name="limit" type="integer">
        The number of subscriptions to return (default: 10, max: 100).
      </Property>
      <Property name="startingAfter" type="string">
        A cursor for pagination.
      </Property>
      <Property name="customerId" type="string">
        Filter by customer ID.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/subscriptions">

    ```php {{ title: 'PHP' }}
    $subscriptions = $vatly->subscriptions->list();

    foreach ($subscriptions as $subscription) {
        echo $subscription->id . ': ' . $subscription->status;
    }

    // Filter by customer
    $subscriptions = $vatly->subscriptions->list([
        'customerId' => 'cus_abc123',
    ]);
    ```

    </CodeGroup>

  </Col>
</Row>

---

## Cancel a subscription {{ tag: 'DELETE', label: '/v1/subscriptions/:id' }}

<Row>
  <Col>

    Cancel a subscription. The subscription will remain active until the end of the current billing period.

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="DELETE" label="/v1/subscriptions/:id">

    ```php {{ title: 'PHP' }}
    $subscription = $vatly->subscriptions->cancel('sub_abc123');

    // Subscription is now 'canceled' but active until period end
    echo $subscription->status;        // 'canceled'
    echo $subscription->currentPeriodEnd;  // When it ends
    ```

    </CodeGroup>

  </Col>
</Row>

---

## Subscription statuses

| Status | Description |
|--------|-------------|
| `active` | Subscription is active and billing |
| `canceled` | Subscription is canceled, active until period end |
| `past_due` | Payment failed, in grace period |
| `trialing` | In trial period |
| `paused` | Subscription is paused |
| `ended` | Subscription has ended |

---

## Helper methods

<Row>
  <Col>

    The Subscription object provides convenient helper methods.

  </Col>
  <Col sticky>

    ```php {{ title: 'PHP' }}
    $subscription->isActive();     // true if status is 'active'
    $subscription->isCanceled();   // true if status is 'canceled'
    $subscription->isTrialing();   // true if status is 'trialing'
    $subscription->isPastDue();    // true if status is 'past_due'
    $subscription->hasEnded();     // true if status is 'ended'
    $subscription->onTrial();      // true if currently in trial
    $subscription->onGracePeriod(); // true if canceled but still active
    ```

  </Col>
</Row>
