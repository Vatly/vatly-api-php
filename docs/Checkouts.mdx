export const metadata = {
  title: 'Checkouts (PHP SDK)',
  description:
    'Learn how to create and manage checkouts using the Vatly PHP SDK.',
}

# Checkouts

Checkouts create hosted payment pages for your customers. When a checkout completes successfully, an Order is created. {{ className: 'lead' }}

## The Checkout Resource

Below you'll find all properties for the Vatly Checkout resource.

### Properties

<Properties>
  <Property name="id" type="string">
    Unique identifier for the checkout (`chk_...`).
  </Property>
  <Property name="status" type="string">
    The status of the checkout: `created`, `paid`, `canceled`, `failed`, or `expired`.
  </Property>
  <Property name="merchantId" type="string">
    Your merchant ID.
  </Property>
  <Property name="orderId" type="string|null">
    Order ID (available after successful payment).
  </Property>
  <Property name="testmode" type="bool">
    Whether this is a test checkout.
  </Property>
  <Property name="redirectUrlSuccess" type="string">
    Success redirect URL.
  </Property>
  <Property name="redirectUrlCanceled" type="string">
    Cancel redirect URL.
  </Property>
  <Property name="metadata" type="array">
    Your custom metadata.
  </Property>
  <Property name="expiresAt" type="string|null">
    Expiration timestamp (ISO 8601).
  </Property>
  <Property name="createdAt" type="string">
    Creation timestamp (ISO 8601).
  </Property>
</Properties>

---

## Create a checkout {{ tag: 'POST', label: '/v1/checkouts' }}

<Row>
  <Col>

    Create a new hosted checkout for your customer.

    ### Required attributes

    <Properties>
      <Property name="products" type="array">
        An array of product objects with `id`, optional `quantity`, and optional `trialDays`.
      </Property>
      <Property name="redirectUrlSuccess" type="string">
        The URL to redirect after successful payment.
      </Property>
      <Property name="redirectUrlCanceled" type="string">
        The URL to redirect if the customer cancels.
      </Property>
    </Properties>

    ### Optional attributes

    <Properties>
      <Property name="customerId" type="string">
        Existing customer ID to associate with this checkout.
      </Property>
      <Property name="metadata" type="array">
        Your custom metadata to store with the checkout.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="POST" label="/v1/checkouts">

    ```php {{ title: 'PHP' }}
    $checkout = $vatly->checkouts->create([
        'products' => [
            [
                'id' => 'plan_abc123',
                'quantity' => 1,
                'trialDays' => 14,
            ]
        ],
        'redirectUrlSuccess' => 'https://yourapp.com/success',
        'redirectUrlCanceled' => 'https://yourapp.com/canceled',
        'customerId' => 'cus_xyz789',
        'metadata' => [
            'user_id' => '12345',
        ],
    ]);

    // Redirect to hosted checkout
    $checkoutUrl = $checkout->getCheckoutUrl();
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "id": "chk_abc123",
      "status": "created",
      "merchantId": "merchant_xyz",
      "orderId": null,
      "testmode": false,
      "redirectUrlSuccess": "https://yourapp.com/success",
      "redirectUrlCanceled": "https://yourapp.com/canceled",
      "metadata": {"user_id": "12345"},
      "createdAt": "2024-12-14T13:32:24.000Z",
      "_links": {
        "checkoutUrl": "https://pay.vatly.com/chk_abc123"
      }
    }
    ```

  </Col>
</Row>

---

## Retrieve a checkout {{ tag: 'GET', label: '/v1/checkouts/:id' }}

<Row>
  <Col>

    Retrieve a checkout by its ID.

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/checkouts/:id">

    ```php {{ title: 'PHP' }}
    $checkout = $vatly->checkouts->get('chk_abc123');

    echo $checkout->id;
    echo $checkout->status;
    echo $checkout->getCheckoutUrl();

    if ($checkout->isPaid()) {
        $orderId = $checkout->orderId;
    }
    ```

    </CodeGroup>

  </Col>
</Row>

---

## List all checkouts {{ tag: 'GET', label: '/v1/checkouts' }}

<Row>
  <Col>

    Retrieve a paginated list of all your checkouts.

    ### Optional attributes

    <Properties>
      <Property name="limit" type="integer">
        The number of checkouts to return (default: 10, max: 100).
      </Property>
      <Property name="startingAfter" type="string">
        A cursor for pagination. Returns results after this checkout ID.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/checkouts">

    ```php {{ title: 'PHP' }}
    // Get all checkouts (paginated)
    $checkouts = $vatly->checkouts->list();

    foreach ($checkouts as $checkout) {
        echo $checkout->id . ': ' . $checkout->status;
    }

    // Pagination
    $checkouts = $vatly->checkouts->list([
        'limit' => 25,
        'startingAfter' => 'chk_last_id',
    ]);
    ```

    </CodeGroup>

  </Col>
</Row>

---

## Checkout statuses

| Status | Description |
|--------|-------------|
| `created` | Checkout is active, awaiting payment |
| `paid` | Payment successful, order created |
| `canceled` | Customer canceled the checkout |
| `failed` | Payment failed |
| `expired` | Checkout expired without completion |

---

## Helper methods

<Row>
  <Col>

    The Checkout object provides convenient helper methods.

  </Col>
  <Col sticky>

    ```php {{ title: 'PHP' }}
    $checkout->isPaid();         // true if status is 'paid'
    $checkout->isCanceled();     // true if status is 'canceled'
    $checkout->isExpired();      // true if status is 'expired'
    $checkout->getCheckoutUrl(); // Hosted checkout page URL
    $checkout->getOrderId();     // Order ID (null if not paid)
    ```

  </Col>
</Row>
